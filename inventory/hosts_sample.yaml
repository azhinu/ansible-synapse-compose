#Hosts to install matrix-synapse bundle
all:
  hosts:
  vars: #Global vars
    ansible_ssh_user: user

   #Start Synapse vars:
    ###Install options for matrix-synapse bundle
    services_dir: /opt/matrix
    ma1sd_enabled: true
    coturn_enabled: false
    nginx_enabled: false
    riot_enabled: false
    riot_version: v1.5.5
    start_services_after_install: true

    ###Postgres
    psql_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    synapse_db_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    #Default synapse user and db: "synapse"

    ###Synapse
    synapse_server_name: matrix.local #Used in matrix users name, e.g @user:matrix.local
    ###To use internal coturn server set "synapse_coturn_address: coturn". Another way set to coturn server address.
    synapse_coturn_address: coturn

    #Enable messanges cleanup script
    synapse_create_admin_user: false
    synapse_admin_user: synapse_admin
    synapse_admin_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"

    coturn_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_registration_shared_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_macaroon_secret_key: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_form_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"


    ###ma1sd
    #####https://github.com/ma1uta/ma1sd
    #####Config file locates at /opt/ma1sd
    ma1sd_ldap_enabled: true
    ma1sd_ldap_host: '{{hostvars[ldap_servers].inventory_hostname}}' #LDAP server address
    ma1sd_ldap_port: '389' #LDAP server port
    ma1sd_ldap_bindDn: 'CN=admin,DC=matrix,DC=lt,DC=loc' #Example for user admin at matrix.local LDAP server
    ma1sd_ldap_bindPassword: '{{LDAP_ADMIN_PASSWORD}}' #By default using password from ldap role
    ma1sd_ldap_baseDNs:
      - 'OU=users,DC=matrix,DC=local'
    ma1sd_ldap_ldap_attribute_uid_type: 'uid'
    ma1sd_ldap_ldap_attribute_uid_value: 'sAMAccountName'
    ma1sd_ldap_ldap_attribute_name: 'cn'

   #END Synapse vars!

   #Start Coturn vars
    coturn_server_address: "{{inventory_hostname}}"
   #END Coturn vars!

   #Start LDAP vars:
    LDAP_PHP_ADMIN: True
    LDAP_ORGANISATION: "Matrix-Synapse"
    LDAP_DOMAIN: "{{inventory_hostname}}"
    LDAP_ADMIN_PASSWORD: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    #END LDAP vars!

    #Start Nginx vars:
    nginx_proxy_server_name: matrix.example.com #Public address for Synapse

  children:
    matrix_servers:
      hosts:
        matrix.local:

    coturn_servers:
      hosts:
       coturn.local:

    ldap_servers:
      hosts:
        #matrix.local

    nginx_servers:
      hosts:
        #matrix.example.org
