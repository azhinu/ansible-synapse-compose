#Hosts to install matrix-synapse bundle
all:
  hosts:
  vars: #Global vars
    ansible_ssh_user: user

   #Start Synapse vars:
    ###Install options for matrix-synapse bundle
    services_dir: /opt/matrix
    coturn_enabled: false
    nginx_enabled: false
    riot_enabled: false
    riot_version: v1.5.5
    start_services_after_install: true

    ###Postgres
    psql_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    synapse_db_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    #Default synapse user and db: "synapse"

    ###Synapse
    synapse_server_name: matrix.local #Used in matrix users name, e.g @user:matrix.local
    ###To use internal coturn server set "synapse_coturn_address: coturn". Another way set to coturn server address.
    synapse_coturn_address: coturn

    #Enable messanges cleanup script
    synapse_cleanup_enabled: true
    synapse_create_admin_user: true

    synapse_admin_user: synapse_admin
    synapse_admin_pass: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"

    coturn_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_registration_shared_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_macaroon_secret_key: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"
    synapse_form_secret: "{{ lookup('password', '/dev/null length=64 chars=hexdigits') }}"

    #LDAP
    synapse_ldap_enabled: false
    synapse_ldap_server: matrix.local:389
    synapse_ldap_base: ou=Users,dc=matirx
    synapse_ldap_bind_dn: cn=admin,dc=matirx
    synapse_ldap_bind_pass: {{LDAP_ADMIN_PASSWORD}}
   #END Synapse vars!

   #Start Coturn vars
    coturn_server_address: "{{inventory_hostname}}"
   #END Coturn vars!

   #Start LDAP vars:
    LDAP_PHP_ADMIN: true
    LDAP_ORGANISATION: "Matrix-Synapse"
    LDAP_DOMAIN: "{{inventory_hostname}}"
    LDAP_ADMIN_PASSWORD: "{{ lookup('password', '/dev/null length=14 chars=ascii_letters,digits') }}"
    #END LDAP vars!

    #Start Nginx vars:
    nginx_proxy_server_name: matrix.example.com #Public address for Synapse

  children:
    matrix_servers:
      hosts:
        matrix.local:

    coturn_servers:
      hosts:
       coturn.local:

    ldap_servers:
      hosts:
        #matrix.local

    nginx_servers:
      hosts:
        #matrix.example.org
